import{d as M,r as m,y as z,o as c,c as b,a as e,z as D,g as d,h as y,F as S,x as I,t as i,u as t,j as H,l as j,p as R,b as W,f as E,E as A,n as G,H as P,e as J}from"./vendor.1d2f60e7.js";import{T as K}from"./Title.2c3d75b4.js";import{_ as Q,e as X,a as U,c as B,b as T,E as Y,s as Z,d as V}from"./index.a210367a.js";import{b as ee,v as ae,a as L}from"./validation.36d38792.js";const $=C=>(R("data-v-3abec82b"),C=C(),W(),C),se={id:"avatar-modal",class:"modal fade",tabindex:"-1"},te={class:"modal-dialog"},oe={class:"modal-content"},le=$(()=>e("div",{class:"modal-header"},[e("h5",null,"Change Avatar"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"}," \u2716\uFE0F ")],-1)),ne={class:"modal-body"},re=["onSubmit"],de=$(()=>e("button",{type:"submit",class:"btn btn-primary"},"\u{1F50E}",-1)),ue=$(()=>e("option",{selected:"",value:null},"All",-1)),ie=["value"],me=$(()=>e("option",{selected:"",value:null},"All",-1)),ce=["value"],pe=$(()=>e("p",{class:"text-center mb-5"},[e("strong",null,"Note:"),E(" Not all emojis will appear for all users. Different devices use different emojis. ")],-1)),ve=M({emits:["updateAvatar"],setup(C,{emit:x}){const g=m(""),_=m([]),r=m(),p=m(),F=X();function f(){_.value=Z(g.value,r.value,p.value),_.value=_.value.filter(a=>a.icon.length<8)}function u(){p.value=null,f()}function w(a){x("updateAvatar",a)}return z(()=>{const a=document.getElementById("avatar-modal"),s=document.getElementById("avatar");a&&s&&a.addEventListener("shown.bs.modal",function(){s.focus()})}),(a,s)=>(c(),b("div",se,[e("div",te,[e("div",oe,[le,e("div",ne,[e("form",{onSubmit:D(f,["prevent"]),class:"row justify-content-center"},[d(U,{class:"col-md-4 mb-3",label:"Search",id:"avatar",type:"search",modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=n=>g.value=n)},{button:y(()=>[de]),_:1},8,["modelValue"]),d(T,{class:"col-md-4 mb-3",label:"Category",id:"category",modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=n=>r.value=n),onChange:u},{options:y(()=>[ue,(c(!0),b(S,null,I(t(F),(n,N)=>(c(),b("option",{key:N,value:n},i(t(B)(n.name)),9,ie))),128))]),_:1},8,["modelValue"]),r.value&&r.value.children[0]?(c(),H(T,{key:0,class:"col-md-4 mb-3",label:"Sub Category",id:"sub-category",modelValue:p.value,"onUpdate:modelValue":s[2]||(s[2]=n=>p.value=n),onChange:f},{options:y(()=>[me,(c(!0),b(S,null,I(r.value.children,(n,N)=>(c(),b("option",{key:N,value:n},i(t(B)(n)),9,ce))),128))]),_:1},8,["modelValue"])):j("",!0)],40,re),pe,d(Y,{emojis:_.value,onUpdate:w},null,8,["emojis"])])])])]))}});var be=Q(ve,[["__scopeId","data-v-3abec82b"]]);const _e={id:"profile",class:"page"},fe=e("span",null,"\u{1F6D1}",-1),we=E(" logout "),he=[fe,we],ge={class:"row"},ye={id:"change-avatar",class:"col-md-6 mb-5 text-center"},Fe={type:"button",class:"btn btn-outline-secondary fs-3 w-100 mb-3","data-bs-toggle":"modal","data-bs-target":"#avatar-modal"},Ve=e("br",null,null,-1),Ee=E(" Change Avatar "),Ce=e("span",null,"\u{1F3AB}",-1),Ne=e("span",null,"\u{1F39F}\uFE0F",-1),ke={class:"col-md-6 mb-5"},Ue={key:0,class:"alert alert-light"},$e=["onSubmit"],xe={class:"alert alert-danger mb-4"},Se={class:"form-btns"},Ie=["disabled"],je=e("span",null,"\u{1F4F2}",-1),Me=M({setup(C){const x=P("authService"),g=P("userService");let _=null;const r=m(),p=m(!1),F=m(!1),f=m(""),u=m(!1),w=m([]),a=A({email:V.getters.userInfo.email,username:V.getters.userInfo.username,password:"",passwordNew:""}),s=A({username:"",email:"",password:"",passwordNew:""});async function n(h){await g.updateAvatar(h)&&(await x.refresh(),_&&_.hide())}async function N(){var o,k,l;let h=!0;if(f.value="",w.value=[],s.username="",s.email="",s.password="",a.username&&(s.username=ee(a.username),s.username&&(h=!1)),a.email&&(s.email=ae(a.email),s.email&&(h=!1)),s.password=L(a.password),s.password&&(h=!1),a.passwordNew&&(s.passwordNew=L(a.passwordNew),s.passwordNew&&(h=!1)),!!h)try{u.value=!0;const v={username:a.username,email:a.email,password:a.password,passwordNew:a.passwordNew?a.passwordNew:null};(await g.updateUser(v)).id&&(f.value="\u2714\uFE0F Information Updated!")}catch(v){v.response&&(((o=v.response.data)==null?void 0:o.statusCode)===400?w.value=v.response.data.message:(((k=v.response.data)==null?void 0:k.statusCode)===401||((l=v.response.data)==null?void 0:l.statusCode)===409)&&w.value.push(v.response.data.message))}finally{u.value=!1}}function O(){x.signout()}async function q(){r.value=await g.getUser()}return z(()=>{_=new bootstrap.Modal(document.getElementById("avatar-modal")),q()}),(h,o)=>{const k=J("router-link");return c(),b("div",_e,[d(K,{title:"Profile",subtitle:`Welcome ${t(V).getters.userInfo.username}!`},null,8,["subtitle"]),e("div",{class:"text-center mb-5"},[e("button",{type:"button",class:"btn btn-outline-secondary fs-3",onClick:O},he)]),e("div",ge,[e("div",ye,[e("button",Fe,[e("span",{class:G({"avatar-wide":t(V).getters.userInfo.avatar.length>3})},i(t(V).getters.userInfo.avatar?t(V).getters.userInfo.avatar:"\u{1F636}"),3),Ve,Ee]),d(k,{to:"/shop",class:"btn btn-outline-secondary fs-3 w-100 mb-3"},{default:y(()=>[Ce,E(" Tickets: "+i(r.value?r.value.tickets:""),1)]),_:1}),d(k,{to:"/shop",class:"btn btn-outline-secondary fs-3 w-100"},{default:y(()=>[Ne,E(" Premium Tickets: "+i(r.value?r.value.premium_tickets:""),1)]),_:1})]),e("div",ke,[f.value?(c(),b("div",Ue,i(f.value),1)):j("",!0),e("form",{onSubmit:D(N,["prevent"]),class:"",novalidate:""},[w.value.length?(c(!0),b(S,{key:0},I(w.value,l=>(c(),b("div",xe," \u26A0\uFE0F "+i(l),1))),256)):j("",!0),d(U,{class:"mb-4",label:"Username",id:"username",type:"text",modelValue:t(a).username,"onUpdate:modelValue":o[0]||(o[0]=l=>t(a).username=l),error:t(s).username,disabled:u.value},null,8,["modelValue","error","disabled"]),d(U,{class:"mb-4",label:"Email",id:"email",type:"email",modelValue:t(a).email,"onUpdate:modelValue":o[1]||(o[1]=l=>t(a).email=l),error:t(s).email,disabled:u.value},null,8,["modelValue","error","disabled"]),d(U,{class:"mb-4",label:"New Password",id:"password-new",type:F.value?"text":"password",modelValue:t(a).passwordNew,"onUpdate:modelValue":o[3]||(o[3]=l=>t(a).passwordNew=l),error:t(s).passwordNew,disabled:u.value,description:"Leave blank to only update email"},{button:y(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:o[2]||(o[2]=l=>F.value=!F.value),"aria-label":"Toggle Show New Password"},[e("span",null,i(F.value?"\u{1F576}\uFE0F":"\u{1F453}"),1)])]),_:1},8,["type","modelValue","error","disabled"]),d(U,{class:"mb-4",label:"Current Password",id:"password-old",type:p.value?"text":"password",modelValue:t(a).password,"onUpdate:modelValue":o[5]||(o[5]=l=>t(a).password=l),error:t(s).password,disabled:u.value,required:""},{button:y(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:o[4]||(o[4]=l=>p.value=!p.value),"aria-label":"Toggle Show Old Password"},[e("span",null,i(p.value?"\u{1F576}\uFE0F":"\u{1F453}"),1)])]),_:1},8,["type","modelValue","error","disabled"]),e("div",Se,[e("button",{type:"submit",class:"btn btn-primary w-100 mb-3 fs-5",disabled:u.value},[je,E(" "+i(u.value?"Loading":"Update"),1)],8,Ie)])],40,$e)])]),d(be,{onUpdateAvatar:n})])}}});export{Me as default};
